{% extends "base/layout.html" %}

{% load staticfiles %}

{% block assets %}
<script type='text/javascript' src="{{ settings.STATIC_LIB_BASE }}jquery/dist/jquery.min.js"></script>

<link href="{{ settings.STATIC_LIB_BASE }}bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="{{ settings.STATIC_LIB_BASE }}bootstrap/dist/js/bootstrap.min.js"></script>

<script type='text/javascript' src="{{ settings.STATIC_LIB_BASE }}moment/min/moment.min.js"></script>
<script type='text/javascript' src="{{ settings.STATIC_LIB_BASE }}eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

<script type='text/javascript' src="{% static "workflow/js/typeahead.bundle.js" %}"></script>

<link rel="stylesheet" href="{% static "base/base.css" %}"/>
<link rel="stylesheet" href="{% static "workflow/css/report.css" %}"/>
<link rel="stylesheet" href="{% static "workflow/css/workflow.css" %}"/>

<script type='text/javascript' src="{% static "workflow/js/street_names.js" %}"></script>
<script type='text/javascript' src="{% static "workflow/js/report.js" %}"></script>

{% endblock %}

{% block body %}

{% load widget_tweaks %}

<div class="container">

    {% if is_new_report %}

        <div class="row subnav">
            <div class="col-md-8 col-md-offset-1">
                <h1>New Report</h1>
            </div>
        </div>

    {% else %}

        <!-- Address, reporter and reported datetime and nav tabs -->
        <div class="row subnav">
            <div class="col-md-8 col-sm-7 col-xs-12">
                {% if form.address.value %}
                    <h1>{{ form.address.value }}</h1>
                {% endif %}
                {% if form.reported_datetime.value and form.name.value %}
                    <p class="reporter-subheader"> reported on {{ form.reported_datetime.value|date }} by {{ form.name.value }}</p>
                {% endif %}
            </div>

            <div class="col-md-4 col-sm-5 col-xs-12">
                <ul class="nav nav-pills pull-right">
                    <li role="presentation" class="active"><a href="#">Report</a></li>
                    {% if verification_id %}
                        <li role="presentation"><a href="/workflow/verification/{{verification_id}}">Verification</a></li>
                    {% else %}
                        <li role="presentation" class="disabled"><a href="#">Verification</a></li>
                    {% endif %}
                    <li role="presentation" class="disabled"><a href="#">Case</a></li>
                </ul>
            </div>
        </div>

    {% endif %}

    <div class="row">
        <div class="col-sm-4 pane-selectors">
            <div class="list-group">
                <h5 class="list-group-item list-group-item-title">Report</h5>
                <a href="#report-details" class="list-group-item active">Report Details<span class="fa fa-list-item fa-angle-right"></span></a>
                <a href="#report-attachments" class="list-group-item">Attachments {% if external_assets_count > 0 %}({{ external_assets_count }}){% endif %}<span class="fa fa-list-item fa-angle-right"></span></a>
                <a href="#report-history" class="list-group-item">History<span class="fa fa-list-item fa-angle-right"></span></a>
            </div>
        </div>

        <!-- Report Details pane -->
        <div class="col-sm-7 col-sm-offset-1 report tab-pane" id="report-details">
          <div class="row">
            <div class="col-sm-12">
              <h4>Report Details</h4>
            </div>
          </div>

<!--                 {% if form.reported_datetime.value and form.name.value %}
              <h4> Reported on {{ form.reported_datetime.value|date }} by {{ form.name.value }}</h4>
          {% endif %}
-->
          <form class="form-contact" id="css-call-form" method="POST">
              {% csrf_token %}

              {{ form.non_field_errors }}

              <div class="row">
                <div class="col-sm-12">
                  <div class="fieldWrapper form-group">
                      <label for="{{ form.reported_datetime.id_for_label }}">Date and time reported:</label>
                      <div class='input-group date' id='datetimepicker'>
                          <input type='text' class="form-control" id="{{ form.reported_datetime.id_for_label }}" name="{{ form.reported_datetime.html_name }}" type="text" value="{{form.reported_datetime.value|date:'m/d/Y'}} {{form.reported_datetime.value|time:'H:i'}}"/>
                          <span class="input-group-addon">
                              <span class="glyphicon glyphicon-calendar"></span>
                          </span>
                      </div>
                      {{ form.reported_datetime.errors }}
                    </div>
                  </div>
                  <script type="text/javascript">
                      $(function () {
                          $('#datetimepicker').datetimepicker({
                              'collapse': true,
                              'format': 'MM/DD/YYYY HH:mm',
                              'useCurrent': false
                          });
                      });
                  </script>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.name.id_for_label }}">Reporter name:</label>
                      {{ form.name|add_class:"form-control" }}
                      {{ form.name.errors }}
                  </div>
                </div>

                <div class="col-sm-6">
                  <div class="form-group reporter_primary_contact">
                      <label for="{{ form.phone.id_for_label }}">Reporter phone:</label>
                      {{ form.phone|add_class:"form-control" }}
                      {{ form.phone.errors }}
                  </div>
                </div>

                <div class="col-sm-6">
                  <div class="form-group reporter_additional_contact">
                      <label for="{{ form.reporter_alternate_contact.id_for_label }}">Reporter additional contact:</label>
                      {{ form.reporter_alternate_contact|add_class:"form-control" }}
                      {{ form.reporter_alternate_contact.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group address-number-field">
                      <label for="{{ form.reporter_address_number.id_for_label }}">Reporter address number:</label>
                      {{ form.reporter_address_number|add_class:"form-control" }}
                      {{ form.reporter_address_number.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group street-name-field">
                      <label for="{{ form.reporter_street_name.id_for_label }}">Reporter street name:</label>
                      {{ form.reporter_street_name|add_class:"form-control typeahead" }}
                      {{ form.reporter_street_name.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.when_last_reported.id_for_label }}">When last reported:</label>
                      {{ form.when_last_reported|add_class:"form-control" }}
                      {{ form.when_last_reported.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.address.id_for_label }}">Address of problem:</label>
                      {{ form.address|add_class:"form-control" }}
                      {{ form.address.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.time_of_day_occurs.id_for_label }}">Time of day issues occurs:</label>
                      {{ form.time_of_day_occurs|add_class:"form-control" }}
                      {{ form.time_of_day_occurs.errors }}
                  </div>
                </div>


                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.num_people_involved.id_for_label }}">Number of individuals involved:</label>
                      {{ form.num_people_involved|add_class:"form-control" }}
                      {{ form.num_people_involved.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.safety_concerns.id_for_label }}">Safety concerns:</label>
                      {{ form.safety_concerns|add_class:"form-control" }}
                      {{ form.safety_concerns.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.problem.id_for_label }}">Description:</label>
                      <textarea id="{{ form.problem.id_for_label }}" maxlength="256" name="{{ form.problem.html_name }}" class="form-control" rows="3">{% if form.problem.value %}{{ form.problem.value }}{% endif %}</textarea>
                      {{ form.problem.errors }}
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.resolution.id_for_label }}">Notes:</label>
                      {{ form.resolution|add_class:"form-control" }}
                      {{ form.resolution.errors }}
                  </div>
                </div>

                <!-- TODO: remove this -->
                <div hidden="true" class="form-group">
                    {{ form.date|add_class:"form-control" }}
                </div>

                <!-- TODO: need to implement this at view and db level -->
                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="type">Type:</label>
                      <select class="form-control">
                          <option>Location</option>
                          <option>Information</option>
                      </select>
                  </div>
                </div>

                <div class="col-sm-12">
                  <div class="form-group">
                      <label for="{{ form.resolution.id_for_label }}">Tags:</label>
                      {{ form.tags|add_class:"form-control" }}
                      {{ form.tags.errors }}
                  </div>
                </div>

                <!--<div class="col-sm-4 pull-right">
                  <button type="submit" class="btn btn-success btn-lg pull-right" aria-haspopup="true" aria-expanded="true">Save</button>
                </div>-->
              </div>

          </form>
        </div>  <!-- end Report Details pane -->

        <!-- Report Attachments pane -->
        <div class="tab-pane" id="report-attachments">
            <div class="col-sm-7 col-sm-offset-1 report">
                <h4>Report Attachments</h4>

                {% for external_asset in external_assets %}
                    <div class="row uploaded-doc">
                        <div class="col-sm-4">
                          <a href="{{ external_asset.asset_url }}" target="_blank"><img class="external-asset" src="{{ external_asset.asset_url }}"></a>
                        </div>

                        <div class="col-sm-8">
                          <ul class="doc-attrs">
                              <li class="doc-name"><h5 class="doc-name-text">Submitted via web form</h5></li>
                              <li class="doc-link"><a href="#">{{ uploaded_doc.filename }}</a></li>
                              <li class="doc-date"><p class="doc-date-text">Added: {{ external_asset.css_report.reported_datetime|date }}</p></li>
                          </ul>
                        </div>
                    </div>

                {% endfor %}

                    <div class="row new-upload">
                      <div class="col-sm-12">
                        <form id="file-upload-form">
                            <h4>Upload a new file</h4>
                            <input type="file" name="uploadDoc">
                        </form>
                      </div>
                    </div>

                {% if external_assets %}

                {% endif %}

                <!-- TODO: write the middleware to handle file upload -->

    <!--                 <form id="file-upload-form">
                    <h5>Upload a new file</h5>
                    <input type="file" name="uploadDoc">
                    <button class="btn btn-primary upload-submit-button" type="submit" form="file-upload-form" value="Submit">Submit</button>
                </form>
    -->
            </div>
        </div>  <!-- end Report Attachments pane -->

        <!-- Report History pane -->
        <div class="tab-pane" id="report-history">
            <div class="col-md-7 col-md-offset-1 report">
                <h4>Report History</h4>

                    <div class="row">
                      <div class="col-sm-12">
                        <div class="table-wrapper">
                          <table class="table table-hover small-table" id="call-log">
                            <thead>
                              <tr>
                                <th>Date</th>
                                <th>Source</th>
                                <th>Code</th>
                                <th>Description</th>
                              </tr>
                            </thead>

                            <tbody>
                              <tr>
                                <td>Today</td>
                                <td><b>RMS</b></td>
                                <td>459</td>
                                <td>This is the description of the service call</td>
                              </tr>

                              <tr>
                                <td>10/15/15</td>
                                <td><b>RMS</b></td>
                                <td>670</td>
                                <td>This is the description of the service call</td>
                              </tr>

                              <tr>
                                <td>10/10/15</td>
                                <td><b>CRW</b></td>
                                <td>E12</td>
                                <td>This is the description of the service call</td>
                              </tr>

                              <tr>
                                <td>10/1/15</td>
                                <td><b>RMS</b></td>
                                <td>459</td>
                                <td>This is the description of the service call</td>
                              </tr>

                              <tr>
                                <td>8/8/15</td>
                                <td><b>RMS</b></td>
                                <td>670</td>
                                <td>This is the description of the service call</td>
                              </tr>

                              <tr>
                                <td>1/23/15</td>
                                <td><b>CRW</b></td>
                                <td>E12</td>
                                <td>This is the description of the service call</td>
                              </tr>
                          </table>
                        </div> <!--table wrapper-->

                      </div>
                    </div>

                  </div><!--contact log table-->

            </div>
        </div>  <!-- end Report Attachments pane -->
    </div>

</div>

<div class="footer container-fluid">
  <div class="container next-actions">
    <form>
      <div class="row">
        <div class="col-sm-6 col-sm-offset-6">
          <div class="form-group col-md-6 col-md-offset-2 col-sm-7 col-sm-offset-1 col-xs-8">
            <select class="form-control">
              <option>Save Report</option>
              <option>Move to Verification</option>
              <option>Forward</option>
              <option>Resolve</option>
            </select>
          </div>

          <div class="col-md-4 col-sm-4 col-xs-4 submit-btn">
            <button type="submit" class="btn btn-success btn-lg pull-right" aria-haspopup="true" aria-expanded="true">Confirm</button>
          </div>
      </div>

    </form>
  </div>
</div>

{% endblock %}
